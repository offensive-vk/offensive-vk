name: âœ… Super Linter 

on:
  schedule:
    - cron: '0 */4 * * *'
  push:
    branches: ['master', '**']
  workflow_dispatch:

permissions:
  contents: write
  packages: read
  statuses: write
  
jobs:
  auto-fix:
    name: Auto Fix Linter
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Checkout
        id: checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm@v9
        run: |
          node -v && npm -v
          npm i -g pnpm@9.0.0
          pnpm -v
          pnpm install

      - name: Run Auto Fixer
        run: | 
          pnpx prettier --write .
          pnpx prettier --check .

      - name: Upload Linter Results
        run: |
          git fetch --all; git pull --verbose
          git checkout -b auto-fix-linter
          git push --set-upstream origin auto-fix-linter
          git status --porcelain

      - name: Commit and Push
        uses: offensive-vk/auto-commit-push@master
        with:
          name: "Hamster [bot]"
          email: "TheHamsterBot@outlook.com"
          message: "Publish Linter Changes and Fixes"
          branch: "auto-fix-linter"
          github-token: ${{ secrets.BOT_TOKEN }}
      
  lint:
    name: Begin Linting
    runs-on: ubuntu-latest
    needs: [auto-fix]
    continue-on-error: true
    strategy:
      fail-fast: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: 'auto-fix-linter'
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm@v9
        run: |
          node -v && npm -v
          npm i -g pnpm@9.0.0
          pnpm -v
          pnpm install

      - name: Lint Codebase
        id: super-linter
        uses: super-linter/super-linter/slim@v7
        env:
          FILTER_REGEX_INCLUDE: \.(yml|yaml)$
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VALIDATE_ALL_CODEBASE: true
          VALIDATE_YAML: true
          VALIDATE_YAML_PRETTIER: true
          VALIDATE_MARKDOWN: false
          VALIDATE_MARKDOWN_PRETTIER: false
          VALIDATE_JAVASCRIPT_STANDARD: false
          VALIDATE_JSCPD: false
          VALIDATE_TYPESCRIPT_STANDARD: false