name: ðŸš€ Automated Comment Reaction

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  add-reaction:
    name: Add Reaction
    runs-on: ubuntu-latest
    steps:
      - name: Show Triggering Event
        run: |
          echo "Triggered by event: ${{ github.event_name }}"

      - name: Setup Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y jq curl

      - name: Add Reaction to Comment
        env:
          GITHUB_TOKEN: ${{ secrets.BOT_TOKEN || secrets.GITHUB_TOKEN }}
        run: |
          # Set the reaction type
          REACTION="rocket"

          # Determine the comment ID from the event payload
          COMMENT_ID=$(jq -r '.comment.id' <<< "${{ toJSON(github.event) }}")

          if [ -z "$COMMENT_ID" ]; then
            echo "No comment ID found in the event payload."
            exit 1
          fi

          # Add the reaction using GitHub API
          API_URL="https://api.github.com/repos/${{ github.repository }}/issues/comments/$COMMENT_ID/reactions"
          RESPONSE=$(curl -s -X POST -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.squirrel-girl-preview+json" \
            -d "{\"content\": \"$REACTION\"}" \
            "$API_URL")

          # Check the API response
          if [ "$(jq -r '.id' <<< "$RESPONSE")" != "null" ]; then
            echo "Successfully added $REACTION reaction to comment $COMMENT_ID"
          else
            echo "Failed to add reaction. Response: $RESPONSE"
            exit 1
          fi
